<html>
<head>
  <title>Using ReMarkdown</title>
  <link rel="stylesheet" href="remarkdown.css">
</head>
<body class="rmd-on">
<!--StartFragment--><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Description</h3><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In this assignment you will learn:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">how to implement a replication mechanism based on Sockets</li><li style="margin: 0px; padding: 0px;">cryptographically securing the communication between clients and Proxy</li><li style="margin: 0px; padding: 0px;">asymmetric and symmetric cryptographic algorithms</li><li style="margin: 0px; padding: 0px;">how to verify message integrity</li><li style="margin: 0px; padding: 0px;">using the Java Cryptography Architecture (JCA) API</li><li style="margin: 0px; padding: 0px;">how to use RMI (Remote Method Invocation)</li><li style="margin: 0px; padding: 0px;">how to deal with high loads</li></ul><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="Overview" id="Overview"></a>Overview</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Lab 2 is divided into the following parts:</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#Replication" style="color: rgb(0, 44, 115); text-decoration: none;"><strong style="font-style: inherit; font-weight: bold;">Stage 1</strong></a> (5 points): Your solution for Lab 1 provides a way to download files made available through our fileserver network. To make things more interesting, a file is not uploaded to every single fileserver, so our fileservers won't be fully replicated any longer. Obvioulsy, we will also need to adapt our implementations of the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!list</code> and <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!download</code> command to fit this situation.<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">Gifford's scheme</strong><span class="Apple-converted-space"> </span>shall be used to keep the access to the replicas consistent.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#SecureChannel" style="color: rgb(0, 44, 115); text-decoration: none;"><strong style="font-style: inherit; font-weight: bold;">Stage 2</strong></a> (10 points): This stage secures the communication between the client and the Proxy by implementing a secure channel and mutual authentication using public-key cryptography. In our case, the secure channel will protect both parties against interception and fabrication of messages. Note that the common definition of a secure channel additionally implies a protection against modification. The client communication will remain vulnerable in this regard; however, Stage 3 will show how to address this issue concerning the communication between the proxy and the fileservers.</p><p class="vspace" id="yui_3_9_1_2_1386451846725_412" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The first part of setting up our secure channel is to mutually authenticate each party (i.e., every party needs to prove its identity). In this assignment we will authenticate using the well-known challenge-response protocol (which is also discussed in the lecture). To subsequently ensure confidentiality of the messages after the authentication, we will use secret-key cryptography by means of session keys. Note that the session key is shared only between one specific client and the Proxy (and not with other clients). It is generated and exchanged during the authentication phase (i.e., if and only if the authentication is successful, both parties will know how to continue communication securely). This approach ensures that the user and the Proxy are having a confidential communication and that each party is who it claims to be.</p><p class="vspace" id="yui_3_9_1_2_1386451846725_408" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#MessageIntegrity" style="color: rgb(0, 44, 115); text-decoration: none;"><strong style="font-style: inherit; font-weight: bold;">Stage 3</strong></a> (5 points): This stage will show you how to verify that a message reaches its receiver unmodified using the JCA. For the sake of simplicity, we will add this feature solely to the otherwise unsecured communication between the Proxy and the fileservers. Here, communication is not protected against interception. By using a Message Authentication Code (MAC) and appending it to each message, the receiver can check whether the message has been modified on the way through the channel.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#RMI" style="color: rgb(0, 44, 115); text-decoration: none;"><strong style="font-style: inherit; font-weight: bold;">Stage 4</strong></a> (10 points): In this stage you will extend your Proxy and Client implementation to add a management component that facilitates RMI. The Management Component provides several operations and convenience methods that can be used by the Client.</p><p class="vspace" id="yui_3_9_1_2_1386451846725_410" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#Testing" style="color: rgb(0, 44, 115); text-decoration: none;"><strong style="font-style: inherit; font-weight: bold;">Stage 5</strong></a> (5 points): To demonstrate that your file download system is able to handle high loads, you will implement a testing framework that simulates realistic user workloads. The testing framework serves as a benchmark for performance characteristics, and it may help in determining multi-threading/synchronization issues (e.g., deadlocks, memory leaks etc.).</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="BouncyCastle" id="BouncyCastle"></a>Installation and Static Registration of the Bouncy Castle Provider</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">For the second and third part we will use the <a class="urllink" href="http://www.bouncycastle.org/" rel="nofollow" style="color: rgb(0, 44, 115); text-decoration: none;">Bouncy Castle</a> library as a provider for the Java Cryptography Extension (JCE) API, which is part of JCA. The Bouncy Castle provider (JDK 1.6 version) is already part of the provided template. Please stick to the provided version as this is the one used in our lab environment.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The provider is configured as part of your Java environment by adding an entry to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.security</code> properties file (found in<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">$JAVA_HOME/jre/lib/security/java.security</code>, where <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">$JAVA_HOME</code> is the location of your JDK distribution). You will find detailed instructions in the file, but basically it comes down to adding this line (but you may need to move all other providers one level of preference up):</p><div class="indent" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">security.provider.1 = org.bouncycastle.jce.provider.BouncyCastleProvider</code></div><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Where you actually put the jar file is mostly up to you, but the best place to have it is in <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">$JAVA_HOME/jre/lib/ext</code>.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The installation of a custom provider is explained in the <a class="urllink" href="http://download.oracle.com/javase/6/docs/technotes/guides/security/crypto/CryptoSpec.html#ProviderInstalling" rel="nofollow" style="color: rgb(0, 44, 115); text-decoration: none;">Java Cryptography Architecture (JCA) Reference Guide</a> in detail.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">Note:</strong> If you get "java.lang.SecurityException: Unsupported keysize or algorithm parameters" or "java.security.InvalidKeyException: Illegal key size" exception while using the Bouncy Castle library, then check this <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#PolicyFiles" style="color: rgb(0, 44, 115); text-decoration: none;">hint</a>.</p><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="Project" id="Project"></a>Project Template</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">To help you start with the assignment, we provide a template with updated and new resources that are needed for this assignment. The project contains the following directories:<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">files, keys, libs , src/main/resources</code>. The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">lib</code> directory contains the Bouncy Castle library. The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys</code> directory contains all the keys required to test your implementation and the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">src/main/resources</code><span class="Apple-converted-space"> </span>directory contains the updated .properties files.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-decoration: line-through;">Each private key used in the client-proxy communication is encrypted with same password:<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">12345</strong>. </span></p><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="update-12-01"></a><strong style="font-style: inherit; font-weight: bold;">Update 2013-12-01: </strong>The private keys used in the client-proxy communication are encrypted with following password for the respective participant: </p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;"><strong style="font-style: inherit; font-weight: bold;">alice=12345</strong></em></li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;"><strong style="font-style: inherit; font-weight: bold;">bill=23456</strong></em></li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;"><strong style="font-style: inherit; font-weight: bold;">proxy=12345 </strong></em></li></ul><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="line-height: 1.231;">The secret key used in the fileserver network is not password protected at all.</span></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">src/main/resources</code> directory you will find configuration files, which are used by the client, fileserver and proxy applications, respectively. In these files you only have to adjust the port properties according to the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#PortPolicy" style="color: rgb(0, 44, 115); text-decoration: none;">Lab Port Policy</a>. All other configuration properties have meaningful default values and you do not need to adapt them. In particular, do not change the names of the properties defined!</p><p class="vspace" id="yui_3_9_1_2_1386451846725_415" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The project also contains a new ant build file (build.xml), in which you only have to adjust the class names. Note that it's absolutely required that we are able to start your programs with these predefined commands!</p><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h2 style="margin: 1em 0px; padding: 0px; font-size: 16px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="Replication" id="Replication"></a>Stage 1 - Replication and Consistency (5 points)</h2><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Gifford's scheme shall be used to keep the access to the replicas consistent. To support this, version numbers shall be assigned to the downloadable files (exactly one version number for one file). Gifford's scheme works as follows: To read a file that has N replicas a so-called read quorum is assembled, i.e. a subset of N<sub style="vertical-align: sub;">R</sub> fileservers among these N replicas. To modify a file a write quorum of N<sub style="vertical-align: sub;">W</sub> fileservers is built in the same way as the read quorum.<span class="Apple-converted-space"> </span><span style="color: rgb(0, 0, 0);">In our case N represents the number of replicas is the number of fileservers.</span></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The two<span class="Apple-converted-space"> </span><span style="color: rgb(0, 0, 0);">numeric</span><span class="Apple-converted-space"> </span>values N<sub style="vertical-align: sub;">R</sub> and N<sub style="vertical-align: sub;">W</sub> need to satisfy two constraints:</p><ol style="margin: 1em 1em 1em 2em; padding: 0px; list-style: decimal outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">N<sub style="vertical-align: sub;">R</sub> + N<sub style="vertical-align: sub;">W</sub> &gt; N</strong></li><li style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">N<sub style="vertical-align: sub;">W</sub> &gt; N/2</strong></li></ol><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0);">Depending on N there might be several different possibilities to built the two quorums, but as long as the constraints are satisfied they are all correct. Although don't just choose N for the quorums as this nullifies Gifford's scheme.</span></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The following figure gives an example of Gifford's scheme. The first three fileservers have been selected as the write quorum, the last two fileservers have been selected as a read quorum.</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; font-size: 13px; margin-bottom: 1em; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); width: 788px;"><tbody><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><img src="https://tuwel.tuwien.ac.at/pluginfile.php/455819/mod_page/content/37/Gifford.png" alt="Gifford's Scheme" width="375" height="142" style="border: 0px;"></td></tr><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><strong style="font-style: inherit; font-weight: bold;">Figure 1</strong></td></tr></tbody></table><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br>To support the upload of files, the client uses the interactive command already used for Lab 1 (!upload). If the above constraints are satisfied then at least one fileserver of the read quorum will lead to recent data. It is the Proxy's task to implement the algorithm correctly.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">When receiving an upload request, the Proxy asks N<sub style="vertical-align: sub;">R</sub> fileservers for the current version number of the respective file. Choose the N<sub style="vertical-align: sub;">R</sub> fileservers with the lowest usage. Then introduce a versioning mechanism: the version of a file depends on the amount of uploads that 'changed' the file. Accordingly, an already existing file has version 0 in the beginning; a file that has just been uploaded and didn't exist before has version 1. Another upload of a file with the same name will increase the version to an amount of 2 and so on. Fileservers do not need to check if the file has been changed or is different from the one that existed before. That is, the used versioning approach is not sophisticated at all and should be straightforward in its implementation.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">After consulting N<sub style="vertical-align: sub;">R</sub> fileservers, the Proxy now knows the most recent version of the file (the highest version returned). By adding this version + 1 to the request, it can now initialize the actual upload to N<sub style="vertical-align: sub;">W</sub> fileservers. Again, these fileservers are the N<sub style="vertical-align: sub;">W</sub> fileservers with the lowest usage. After this, it updates the usage statistics of these fileservers (i.e., the filesize is added to the current values) and informs the client of the successful operation.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Fileservers simply need to store the uploaded files in their file directory<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;"></code>. Moreover, since each fileserver keeps track of the current version of each hosted file, it has to update the version to the value sent by the Proxy. It is enough to keep version information in memory; that is, versions do not need to survive fileserver restarts.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">You will also need to adapt your former solution regarding the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!download</code> and <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!list</code> commands: If the Proxy receives a download request, it asks N<sub style="vertical-align: sub;">R</sub> fileservers (the N<sub style="vertical-align: sub;">R</sub> with the lowest usage) for the current version of this file and obtains it from the one with the highest version. If multiple fileservers provide this version, the fileserver with the lowest usage is chosen. Do not forget to update the usage of the chosen fileserver afterwards. Concerning the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!list</code> command, contact all fileservers and send a merged list back to the client.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Concerning the implementation of Gifford's scheme, you may assume that no additional fileservers will join the network or old ones disappear after the first client has made an upload. However, make sure that your implementation is reasonably stable, in particular make sure that correct synchronisation of concurrent client requests is ensured.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><hr><div class="vspace" style="margin: 0px; padding: 0px;"></div></div><h2 style="margin: 1em 0px; padding: 0px; font-size: 16px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="SecureChannel" id="SecureChannel"></a>Stage 2 - Secure Channel (10 points)</h2><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The first stage of establishing a secure channel is a mutual authentication. We will authenticate a client and the Proxy using public-key cryptography. This type of authentication is explained in the book <em style="font-style: italic; font-weight: inherit;">Distributed Systems: Principles and Paradigms (2nd edition)</em>, page 404, Figure 9-19. However, we also describe the principles in detail below.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Please note that in this assignment you are not allowed to use <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">javax.crypto.CipherInputStream</code> and <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">javax.crypto.CipherOutpurStream</code>. Instead you should encrypt and decrypt all messages yourself.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In order to get rid of any special characters which are unsuitable for transmission as text you should <strong style="font-style: inherit; font-weight: bold;">encode your already encrypted messages using Base64 before transmission</strong> (see <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#CodeSnippets" style="color: rgb(0, 44, 115); text-decoration: none;">code snippets</a> below). However, do not forget to Base64 decode the messages after receiving, otherwise the decryption of the messages will of course fail.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">We highly recommend to hide the security aspects from the rest of your application as much as possible. Note that plain Sockets or encrypted channels have many communalities, e.g., the are both used to send and receive messages. Therefore, it may be a good idea to define a common interface that abstracts the details of the underlying implementation away. You should use the <a class="urllink" href="http://en.wikipedia.org/wiki/Decorator_pattern" rel="nofollow" style="color: rgb(0, 44, 115); text-decoration: none;">Decorator pattern</a> to add further functionalities step by step: For example, you could write a <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">TCPChannel </code>that implements your <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Channel</code> interface and provides ways to send and receive Objects over a Socket. Next, you could write a <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Base64Channel</code> class that also implements your <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Channel</code> interface and encodes or decodes Objects using Base64 before passing them to the underlying <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">TCPChannel</code>. Following this approach may simplify your work in Stage 2 and 3.</p><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="AuthenticationAlgorithm" id="AuthenticationAlgorithm"></a>Authentication Algorithm</h3><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">Note:</strong> <strong style="font-style: inherit; font-weight: bold;">You should implement the authentication algorithm (including the syntax of messages) exactly as described here!</strong> Failure to do so may result in losing points. The reason for this is that we will probably test your assignment using a modified client which relies on the protocol being <strong style="font-style: inherit; font-weight: bold;">exactly</strong> as described. Do yourself and the tutors a favor and implement the protocol as described.</p><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><table border="0" style="border-collapse: collapse; border-spacing: 0px; font-size: 13px; margin-bottom: 1em; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); width: 788px;"><tbody><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><img src="https://tuwel.tuwien.ac.at/pluginfile.php/455819/mod_page/content/37/stage2.png" alt="Stage 2 - Channel creation" width="769" height="123" style="border: 0px;"></td></tr><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><strong style="font-style: inherit; font-weight: bold;">Figure 2</strong></td></tr></tbody></table><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><br>The authentication algorithm consists of sending three messages:</div><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">1st Message:</strong> The first message is a <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login</code> request (analogous to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login</code> command from Lab 1). The syntax of the message is: <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login &lt;username&gt; &lt;client-challenge&gt;</code>. This message is sent by the client and is encrypted using RSA initialized with the Proxy's public key.</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">username</code> is the name of the user who wants to authenticate and log in (e.g. alice) and is passed to the Client by the user using the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login &lt;username&gt; </code>command.</li><li style="margin: 0px; padding: 0px;">The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">client-challenge</code> is a 32 byte random number, which the client generates freshly for each request (see <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#CodeSnippets" style="color: rgb(0, 44, 115); text-decoration: none;">code snippets</a> to learn how to generate a secure random number). Encode the challenge separately using Base64 before encrypting the overall message.</li><li style="margin: 0px; padding: 0px;">Initialize the RSA cipher with the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">"RSA/NONE/OAEPWithSHA256AndMGF1Padding"</code> algorithm.</li><li style="margin: 0px; padding: 0px;">As stated above, do not forget to encode your overall ciphertext using Base64 before sending it to the Proxy.</li></ul><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">2nd Message:</strong> The second message is sent by the Proxy and is encrypted using RSA initialized with the user's public key. Its syntax is: <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!ok &lt;client-challenge&gt; &lt;proxy-challenge&gt; &lt;secret-key&gt; &lt;iv-parameter&gt;</code>.</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">client-challenge</code> is the challenge that client sent in the first message. This proves to the client that the Proxy successfully decrypted the first message (i.e., it proves the Proxy's identity).</li><li style="margin: 0px; padding: 0px;">The <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy-challenge</code> is also a 32 byte random number generated freshly for each request by the Proxy.</li><li style="margin: 0px; padding: 0px;">The last two arguments are our session key. The first part is a random 256 bit secret key and the second is a random 16 byte initialization vector (IV) parameter.</li><li style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">Every argument</strong> has to be encoded using Base64 before encrypting the overall message!</li><li style="margin: 0px; padding: 0px;">The ciphertext is sent Base64 encoded again.</li></ul><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">3rd Message:</strong> The third message is just the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy-challenge</code> from the second message. This proves to the Proxy that the client successfully decrypted the second message (i.e., it further proves the client's identity). This message is the first message sent using AES encryption.</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">Initialize the AES cipher using the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&lt;secret-key&gt;</code> and the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&lt;iv-parameter&gt;</code> from the second message. Details about these parameters are out of scope of this lab - you will learn about them in a Cryptography lecture.</li><li style="margin: 0px; padding: 0px;">Use the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">"AES/CTR/NoPadding"</code> algorithm for the AES cipher.</li><li style="margin: 0px; padding: 0px;">Again, encrypt and encode the message before sending it.</li></ul><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The final end product of the authentication is an AES-encrypted secure channel between the client and the Proxy, which is used to encrypt all future communication. You MAY NOT send any message unencrypted (between a client and the Proxy) in this assignment. You MAY NOT send any messages besides the first two authentication messages (as described above) using the RSA encryption (i.e., the RSA encryption is strictly for the authentication part).</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">To generate a random 32 byte numbers to be used for challenges and random 16 bytes numbers to be used for IV parameter, you should use the<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.security.SecureRandom</code> class and its <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">nextBytes()</code> method as shown in the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#FAQ" style="color: rgb(0, 44, 115); text-decoration: none;">Hints &amp; Tricky Parts</a> section. Base64 encodinging them is required because this method could return bytes which are unsuited to be inserted in a text message. Same holds true for random secret keys in the AES algorithm (see the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#FAQ" style="color: rgb(0, 44, 115); text-decoration: none;">Hints &amp; Tricky Parts</a> section on how to generate them). That is: Always encode your challenges, IV parameters and secret keys separately in your message using Base64. This message is then encrypted and gets Base64-encoded again before sending it.</p><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Client Application Behavior</h3><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">When a client application is started, it doesn't know which user will try to log in. Therefore the client application will need to process the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login</code> request before it is sent to the Proxy to find out which user is trying to log in and read his private key (used for decrypting the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!ok</code> message). Make sure a private key for this user does exist, otherwise, print an exception. The processing of the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!login</code> command also includes appending the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">client-challenge</code>.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">There are two new configuration properties in the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">client.properties</code> file, which the client application will need for the authentication phase:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code> property denotes the directory where to look for the user's private key (named <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&lt;username&gt;.pem</code>),</li><li style="margin: 0px; padding: 0px;">and the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.key</code> property defines the file from where to read Proxy's public key.</li></ul><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Proxy Application Behavior</h3><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The Proxy application should read its private key during the startup time. The user's public keys are read when the Proxy receives a log in request. The user is said to be online when the authentication phase is successfully completed.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">There are also two configuration properties in the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.properties</code> file, which the Proxy will need for the authentication phase:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code> property denotes a directory where to look for user's public keys (named <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&lt;username&gt;.pub.pem</code>),</li><li style="margin: 0px; padding: 0px;">and the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">key</code> property telling where to read the Proxy's private key.</li></ul><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px;"><hr><div class="vspace" style="margin: 0px; padding: 0px;"></div></div></div><h2 style="margin: 1em 0px; padding: 0px; font-size: 16px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="MessageIntegrity" id="MessageIntegrity"></a>Stage 3 - Message Integrity (5 points)</h2><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong style="font-style: inherit; font-weight: bold;">Note:</strong> You should implement the syntax for private messages exactly as described here, for the same reasons as discussed above. Furthermore, make sure that the UDP messages your fileservers send to the Proxy actually adhere to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!alive &lt;tcpPort&gt;</code> format (this has to do with the way we will test this stage during your interview).</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In this part of the assignment we will add an integrity check for the TCP messages exhanged between the Proxy and the Fileservers. However, the communication won't get encrypted - the implementation will only make sure that a third party cannot tamper with a message unnoticed. To this, it relies on Message Authentication Codes (MACs).</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Whenever the Proxy sends a TCP request to a fileserver and whenever a fileserver responds, the application needs to compute a HMAC (a hash MAC). To generate such a HMAC you should use SHA256 hashing (<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">"HmacSHA256"</code>) initialized with a secret key shared between the Proxy and all fileservers in the network. See the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#FAQ" style="color: rgb(0, 44, 115); text-decoration: none;">Hints &amp; Tricky Parts</a> on how to read in the shared secret key or create and initialize HMACs. After the HMAC is generated, it should be encoded using Base64.<span class="Apple-converted-space"> </span><span style="text-decoration: line-through; color: rgb(0, 0, 0);"></span><span style="color: rgb(0, 0, 0);">Prepend the original message with the HMAC (e.g. &lt;HMAC&gt; !upload &lt;filename&gt; &lt;version&gt; &lt;filecontent&gt;) <span style="text-decoration: line-through;">and Base64 encode the resulting message before sending it</span><span class="Apple-converted-space"> </span>(<a name="update-11-25"></a><strong style="font-style: inherit; font-weight: bold;">update 2013-11-25</strong>: no need to Base64 encode the entire message, just make sure that the HMAC is transmitted as a String, i.e., Base64 encoded).<br></span></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">To verify the integrity of the message, the receiver generates a new HMAC of the received plaintext to compare it with the received one. In case of a mismatch, the behaviour of a fileserver should be as follows: The respective message is printed to the standard output and the Proxy is informed about the tampering, using the same channel the message was received. When the Proxy receives this report or notices a message from a fileserver itself was changed, the Proxy repeats the respective operation. Like a fileserver, whenever it receives unverified messages, the Proxy has to print their content to the console.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Note that the described behaviour now requires the fileservers to respond to every request that arrives from the Proxy. Nevertheless, stick to the design of Lab1 where the TCP connection was closed after a single request/response cycle, even though an unverified message has been received.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In order to read the secret key both <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.properties</code><span class="Apple-converted-space"> </span>and<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">fs1.properties</code><span class="Apple-converted-space"> </span>(respectively <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">fs2.properties</code>) define a <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">hmac.key</code> property, which denotes from where to read the secret key.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px;"><hr><div class="vspace" style="margin: 0px; padding: 0px;"><h2 style="margin: 1em 0px; padding: 0px; font-size: 16px; font-weight: bold;"><a name="RMI" id="RMI"></a>Stage 4 - RMI (10 points)</h2><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold;">Description</h3><p style="margin: 0px 0px 1em; padding: 0px;">In this assignment you will learn:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;">the basics of a simple distributed object technology (RMI)</li><li style="margin: 0px; padding: 0px;">how to bind and lookup objects with a naming service</li><li style="margin: 0px; padding: 0px;">how to implement callbacks with RMI</li></ul><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;">Overview</h4><p style="margin: 0px 0px 1em; padding: 0px;">In this stage you will extend your Proxy of the first lab by adding a management component. This component will provide several methods that can be used by the client to e.g. retrieve statistics about the replication mechanism. The following figure depicts the overall updated (simplified) architecture of our system.</p><table border="0" style="border-collapse: collapse; border-spacing: 0px; font-size: inherit; margin-bottom: 1em; width: 788px;"><tbody><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><img src="https://tuwel.tuwien.ac.at/pluginfile.php/455819/mod_page/content/37/overview_lab2.gif" alt="Lab2 RMI overview" width="507" height="577" style="border: 0px;"></td></tr><tr><td align="center" style="margin: 0px; padding: 0.5em; border: 0px solid rgb(0, 0, 0);"><strong style="font-style: inherit; font-weight: bold;">Figure 3</strong></td></tr></tbody></table><p style="margin: 0px 0px 1em; padding: 0px;">In Figure 3 you will see that the Proxy now has two components, which are the Common-Component (left-hand side) and the Management-Component (right-hand side). The Common-Component, which was already implemented by you as part of the previous lab, uses TCP for the communication with clients. In contrast the Management-Component represents the new part of the Proxy and communicates with the Client via RMI, where in the Figure the doted lines represent the communication of Client and Proxy via RMI. In order to address these changes you have to extend both your Proxy and Client implementation from Lab 1.</p><p style="margin: 0px 0px 1em; padding: 0px;">Overall the Proxy - Management Component provides the following operations:</p><ol style="margin: 1em 1em 1em 2em; padding: 0px; list-style: decimal outside;"><li style="margin: 0px; padding: 0px;">An operation to request the currently used Read-Quorum (can be omitted if Stage 1 was not solved)</li><li style="margin: 0px; padding: 0px;">An operation to request the currently used Write-Quorum (can be omitted if Stage 1 was not solved)</li><li style="margin: 0px; padding: 0px;">An operation to request a list of the Top Three of all downloaded files. Where the top three is an ordered list of files that got downloaded the most.</li><li style="margin: 0px; padding: 0px;">An operation that allows a user to subscribe for a given file and get a notification, when the file got downloaded for a given number of times. In order to implement this behavior the Client creates a remote callback object and adds this object when invoking the method. The Management Component stores this callback object and whenever the defined number of downloads is reached the Client gets notified by using its callback.</li><li style="margin: 0px; padding: 0px;">An operation that allows a user to gather the public key of the Proxy.</li><li style="margin: 0px; padding: 0px;">An operation that allows a user to transmit his own public key to the Proxy.</li></ol><p style="margin: 0px 0px 1em; padding: 0px;">Have a look at the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#FAQ_RMI" style="color: rgb(0, 44, 115); text-decoration: none;">Hints &amp; Tricky Parts</a> section, in case you should face any difficulties!</p><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;">Proxy Updates<br><br></h4><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;"><a name="serverArguments" id="serverArguments"></a>Arguments</h5><p style="margin: 0px 0px 1em; padding: 0px;">Additionally to the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.properties</code><span class="Apple-converted-space"> </span>the Proxy should now also read the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">mc.properties</code><span class="Apple-converted-space"> </span>file, which defines the following properties:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">binding.name</code>: the name the management component shall use to bind its remote reference in the RMI registry.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.host</code>: the host name or IP address where the Proxy is running.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.rmi.port</code>: the TCP port where the Proxy is listening for connections.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code>: the directory where the to look and store keys.</li></ul><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;">Implementation Details</h5><p style="margin: 0px 0px 1em; padding: 0px;">RMI uses the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 1.231; font-size: 13px;">java.rmi.registry.Registry</code> service to enable applications to retrieve remote objects. This service can be used to reduce coupling between clients (looking up) and servers (binding): the real location of the server object becomes transparent. In our case, the management component will use the registry for binding and the client will look up the remote objects.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">One of the first things the management component needs to do is to connect to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code>, therefore it has to set up the RMI registry. This can be achieved by calling the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">LocateRegistry.createRegistry(int port)</code> method, which creates and exports a <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code> instance on localhost. Use the provided property (named <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.rmi.port</code>) to get the port the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code> should accept requests on. Furthermore use the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.host</code> to read the host the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code> is bound to. This information is vital to the client application that needs to connect to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code> using the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">LocateRegistry.getRegistry(String host,int port)</code> method.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">After obtaining a reference to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code>, this service can be used to bind an RMI remote interface (using the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry.bind(String name, Remote obj)</code>method). Remote Interfaces are common Java Interfaces extending the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.Remote</code> interface. Methods defined in such an interface may be invoked from different processes or hosts. In our case, methods may be invoked by clients. The remote object you bind to the registry should contain exactly the previously mentioned 6 methods, which you have to bind to the registry. Furthermore to implement the notification mechanism for the client, the client has to provide a callback object. This callback objects again implements a remote interface, but the method(s) defined there are now designated to be used by a client. This way, you only have to bind a single object to the registry.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">The Management Component of your Proxy is now ready to serve requests. Requests are handled by the remote object, which implements the methods that may be called by clients.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">To make your object remotely available you have to export it. This can either be accomplished by extending <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.server.UnicastRemoteObject</code> or by directly exporting it using the static method <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">UnicastRemoteObject.exportObject(Remote obj, int port)</code>. In the latter case, use 0 as port: This way, an available port will be selected automatically.</p><div class="vspace" style="margin: 0px; padding: 0px;"><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;">Client  Updates<br><br></h4><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;"><a name="clientArguments" id="clientArguments"></a>Arguments</h5><p style="margin: 0px 0px 1em; padding: 0px;">Additionally to the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">client.properties</code><span class="Apple-converted-space"> </span>the Client should now also read the<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">mc.properties</code><span class="Apple-converted-space"> </span>file, which defines the following properties:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">binding.name</code>: the name the management component shall use to bind its remote reference in the RMI registry.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.host</code>: the host name or IP address where the Proxy is running.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">proxy.rmi.port</code>: the TCP port where the Proxy is listening for connections.</li><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code>: the directory where the to look and store keys.</li></ul><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;"><a name="clientImplementation" id="clientImplementation"></a>Implementation Details</h5><p style="margin: 0px 0px 1em; padding: 0px;">At startup, the client reads out the previously mentioned properties to obtain the information where the RMI registry is located. The client is then able to retrieve the remote reference of the server using the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">binding.name</code> property. Next you should export the client's remote object (callback object) so that the Proxy can notify the user about a subscription. The classes and methods you will need for all these steps have already been explained above: <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">LocateRegistry.getRegistry(String host,int port)</code>, <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry.lookup(String name)</code> and <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">UnicastRemoteObject.exportObject(Remote obj, int port)</code>. Note that a client, in contrast to the servers, must not bind any objects to the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Registry</code>.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">After these steps, the user can already type in commands. Please note that the Proxy's task is to check whether a specified user exists; that is, your Proxy should be able to deal with wrong inputs.</p><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold;"><a name="interactiveCommands" id="interactiveCommands"></a>New Interactive commands</h5><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!readQuorum</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">This command returns the number of Read-Quorums that are currently used for the replication mechanism.</div><div class="indent" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">This command does not require the user to be logged in!</strong></div><div class="indent" style="margin: 0px; padding: 0px;"></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !readQuorum</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Read-Quorum is set to 2.<br></code></div><div class="indent" style="margin: 0px; padding: 0px;"></div><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!writeQuorum</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">This command returns the number of Write-Quorums that are currently used for the replication mechanism. <br><div class="vspace" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">This command does not require the user to be logged in!</strong></div><div class="vspace" style="margin: 0px; padding: 0px;"></div><div class="vspace" style="margin: 0px; padding: 0px;"></div></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !writeQuorum</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Write-Quorum is set to 3.</code></div><div class="indent" style="margin: 0px; padding: 0px;"></div><div class="indent" style="margin: 0px; padding: 0px;"><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!topThreeDownloads</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">This command retrieves a sorted list that contains the 3 files that got downloaded the most. Where the first file in the list, represents the file that got downloaded the most.<div class="vspace" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">This command does not require the user to be logged in!</strong></div><div class="vspace" style="margin: 0px; padding: 0px;"></div></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !topThreeDownloads</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Top Three Downloads:</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">1. short.txt 20</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">2. long.txt  15</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">3. misc.txt  10</code></div><div class="indent" style="margin: 0px; padding: 0px;"></div></div><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!subscribe &lt;filename&gt; &lt;numberOfDownloads&gt;</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">When using this command the user creates a subscription for the given file, which means that the user gets notified by the Proxy whenever the file gets downloaded the given number of times. Together with the parameters, the client should also send its remote object as a callback object for the Proxy. Without the callback object, the Proxy has no possibility to notify the client.</div><div class="indent" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">A successful login is required for this command! Furthermore update the<span class="Apple-converted-space"> </span><em style="font-style: italic; font-weight: inherit;">logout</em><span class="Apple-converted-space"> </span>respectively<span class="Apple-converted-space"> </span><em style="font-style: italic; font-weight: inherit;">exit</em><span class="Apple-converted-space"> </span>command so that the Proxy removes any existing callback object it may have stored for this client. If the user is no longer logged in, the Proxy can drop any subscriptions of this user!</strong></div><div class="indent" style="margin: 0px; padding: 0px;"></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !subscribe short.txt 10</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Successfully subscribed for file: short.txt</code></div><div class="indent" style="margin: 0px; padding: 0px;"></div><div class="indent" style="margin: 0px; padding: 0px;">After the file got downloaded 10 times the client receives the following notification:</div><div class="indent" style="margin: 0px; padding: 0px;"></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Notification: short.txt got downloaded 10 times!.</code></div><div class="indent" style="margin: 0px; padding: 0px;"></div><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!getProxyPublicKey</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">A User can use this command to retrieve the Proxy's public key. When invoking this command the Proxy sends it's public key and the client stores the key in the key folder (given<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code><span class="Apple-converted-space"> </span>property).<br><div class="vspace" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold;">This command does not require the user to be logged in!</strong></div><div class="vspace" style="margin: 0px; padding: 0px;"></div></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !getProxyPublicKey</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Successfully received public key of Proxy.</code></div><div class="indent" style="margin: 0px; padding: 0px;"></div><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">!setUserPublicKey &lt;userName&gt;</code></li></ul><div class="indent" style="margin: 0px; padding: 0px;">With this command the user can exchange it's own public key with the Proxy. Therefore additionally to the name, the client should also send the public key for the given name. The Proxy stores the received key in the key folder (given <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">keys.dir</code> property).<div class="vspace" style="margin: 0px; padding: 0px;"><strong style="font-style: inherit; font-weight: bold; line-height: 1.231;">This command does not require the user to be logged in!</strong></div><div class="vspace" style="margin: 0px; padding: 0px;"></div></div><div class="indent" style="margin: 0px; padding: 0px;">E.g.:</div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">&gt;: !setUserPublicKey Alice</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Successfully transmitted public key of user: Alice.</code></div><p style="margin: 0px 0px 1em; padding: 0px;"></p></div><hr><div class="vspace" style="margin: 0px; padding: 0px;"><h2 style="margin: 1em 0px; padding: 0px; font-size: 16px; font-weight: bold;"><a name="Testing" id="Testing"></a>Stage 5 - Testing / Multi-Threading (5 points)</h2><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold;"><a name="LoadTest" id="LoadTest"></a>Load Testing Component</h3><p style="margin: 0px 0px 1em; padding: 0px;">In practice, file download systems are highly concurrent and should provide robustness and scalability, even for a large number of clients. Concurrency issues are hard to detect under normal operation, but generating artificial load on the system may help to detect problems and inconsistencies. Hence, you should create a load testing component to test the system's scalability and reliability. The following test parameters should be configurable in a properties file<span class="Apple-converted-space"> </span><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">src/test/resources/loadtest.properties</code>:</p><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside;"><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;">clients</em>: Number of concurrent download clients</li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;">uploadsPerMin:</em><span class="Apple-converted-space"> </span>Number of initiated uploads per client per minute</li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;">downloadsPerMin</em>: Number of initiated downloads per client per minute</li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;">fileSizeKB</em>: Size of files available for download, in KiloBytes (simply generate test files with random content)</li><li style="margin: 0px; padding: 0px;"><em style="font-style: italic; font-weight: inherit;">overwriteRatio</em>: average ratio of uploads which overwrite an existing file (updating its version etc), as opposed to uploads which create a new file. For instance,<span class="Apple-converted-space"> </span><em style="font-style: italic; font-weight: inherit;">overwriteRatio=0.8</em><span class="Apple-converted-space"> </span>means that 80% of uploads in the test environment overwrite an existing file.</li></ul>Moreover, the test environment should instantiate a client which subscribes to one or multiple files and receives notifications as soon as this/these file(s) are downloaded. During the tests, the client should simply print all the incoming events automatically to the command line.</div><div class="vspace" style="margin: 0px; padding: 0px;"></div><div class="vspace" style="margin: 0px; padding: 0px;">Play around with different test settings and try to roughly determine the limits of your machine. By limits we mean the configuration values for which the system is still stable, but becomes unstable (e.g., runs out of memory after some time) if any of these values are further increased (or decreased). Monitor the memory usage with tools like "top" (Unix) or the process manager under Windows, and let the test program execute for a sufficiently long time (around 5-10 minutes). Obviously, the load test can also help you identify issues in your implementation (e.g., deadlocks, memory leaks, ...).<p class="vspace" style="margin: 0px 0px 1em; padding: 0px;">In your submission, include a file<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">evaluation.txt</strong><span class="Apple-converted-space"> </span>in which you provide your machine characteristics (operating system version, number and clock frequency of CPUs, RAM capacity) and the key findings of your evaluation (at least the limit values for all configuration parameters).<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">Note:<span class="Apple-converted-space"> </span></strong>Please try to<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">avoid</strong><span class="Apple-converted-space"> </span>running your tests on our<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">lab servers</strong>; however, if it is absolutely necessary that you run the tests on the servers,<span class="Apple-converted-space"> </span><strong style="font-style: inherit; font-weight: bold;">make sure that your tests terminate after a short time</strong><span class="Apple-converted-space"> </span>(say, 5 minutes)! The servers will be monitored and long-running resource-greedy processes may be forcibly killed without prior notice! If you decide to use the servers, only execute the final run of your evalution on the servers, but please develop your code somewhere else (e.g., on the PCs in the DSLab) to avoid blocking the server resources for other students. Also, we advise you not to use (and rely on) the Lab servers in the last days before the deadline.</p><div class="vspace" style="margin: 0px; padding: 0px;"><hr></div></div></div></div></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="PortPolicy" id="PortPolicy"></a>Lab Port Policy</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Since it is not possible to open <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">ServerSocket</code> on ports where other services are already listening for requests, we have to make sure each students uses its own port range. <br>So if you are testing your solution in the lab environment (i.e., on the lab server) you have to obey the following rule: you may only use ports between <strong style="font-style: inherit; font-weight: bold;">10.000 + dslabXXX * 10</strong> and <strong style="font-style: inherit; font-weight: bold;">10.000 + (dslabXXX + 1) * 10 - 1</strong>. So if your account is dslab250 you may use the ports between 12500 and 12509 inclusive. Note that you can use the same port number for TCP and UDP services (e.g., it is possible to use TCP port 12500 and UDP port 12500 at the same time).</p><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="REGEX" id="REGEX"></a>Regular expressions</h3><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">We provide some regular expressions you can use to <strong style="font-style: inherit; font-weight: bold;">verifiy that the messages you exchange between the three applications are well-formed</strong>. This is important because we will test your program against own code. We recommend to use Java assertions for this. The provided build file enables them automatically.</p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">final String B64 = "a-zA-Z0-9/+";</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// stage II</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// Note that the verified messages still need to be encrypted (using RSA or AES, respectively) and encoded using Base64!!!</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// login request send from the Client to the Proxy</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String firstMessage = ...</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">assert firstMessage.matches("!login \\w+ ["+B64+"]{43}=") : "1st message";</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// the Proxy's response to the client</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String secondMessage = ...</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">assert secondMessage.matches("!ok ["+B64+"]{43}= ["+B64+"]{43}= ["+B64+"]{43}= ["+B64+"]{22}==") : "2nd message";</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// the last message send by the Client</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String thirdMessage = ...</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">assert thirdMessage.matches("["+B64+"]{43}=") : "3rd message";</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// stage III</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// UDP message that is send from the fileserver to the Proxy in a recurring manner</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String udpMessage = ...</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">assert message.matches("!alive 1[0-9]{4}");</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// messages beeing exchanged between Proxy and fileservers before the final Base64 encoding</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String hashedMessage = ...</code><del><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;"></code></del><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">assert message.matches("["+B64+"]{43}= [\\s[^\\s]]+");</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="FAQ" id="FAQ"></a>Hints &amp; Tricky Parts (Security)</h3><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="PolicyFiles" id="PolicyFiles"></a>"java.lang.SecurityException: Unsupported keysize or algorithm parameters" or "java.security.InvalidKeyException: Illegal key size"</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">You will need to install the Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files from <a class="urllink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" rel="nofollow" style="color: rgb(0, 44, 115); text-decoration: none;">Java SE Download</a> page (last download link). The installation explanation can be found in README file, but basically you will just have to copy <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">local_policy.jar</code> and <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">US_export_policy.jar</code> into<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">$JAVA_HOME/jre/lib/security/</code> directory.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The decrypted messages are in gibberish and no exception is thrown.</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Possible reasons:</p><ol style="margin: 1em 1em 1em 2em; padding: 0px; list-style: decimal outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">You forgot to decode the decrypted message back from Base64 format.</li><li style="margin: 0px; padding: 0px;">Wrong value was used for initialization vector (IV) parameter when initializing the AES cipher.</li><li style="margin: 0px; padding: 0px;">You didn't use <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Cipher.DECRYPT_MODE</code> when initializing the AES cipher</li></ol><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">java.security.NoSuchProviderException: No such provider: BC</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">This exception is thrown when the Bouncy Castle library is not properly installed. Please recheck that you correctly did all the steps from the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#BouncyCastle" style="color: rgb(0, 44, 115); text-decoration: none;">Installation and Static Registration of the Bouncy Castle Provider</a> section and actually use the so configured JDK.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">java.security.NoSuchAlgorithmException: No such algorithm: "..."</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">The most probable cause is that you misspelled the name of the algorithm. Please check that name of the algorithm is same as mentioned in this assignment. <br>This exception is also thrown when the Bouncy Castle provider is not properly installed. If the name of the algorithm is correct, than you should recheck that you correctly did all the steps from the <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#BouncyCastle" style="color: rgb(0, 44, 115); text-decoration: none;">Installation and Static Registration of the Bouncy Castle Provider</a> section.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">java.security.InvalidKeyException: no IV set when one expected</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">You forgot to initialize the AES cipher using the initialization vector (IV) parameter. The IV parameter is mandatory for the <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">"AES/CTR/NoPadding"</code> algorithm. See <a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#CodeSnippets" style="color: rgb(0, 44, 115); text-decoration: none;">code snippets</a> on how to correctly initialize the AES cipher.</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h4 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="CodeSnippets" id="CodeSnippets"></a>Helpful Code Snippets</h4><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">All code snippets are just examples and omit all exception handling for clarity. This does not mean that you should not do exception handling in your lab solution!</p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#Base64" style="color: rgb(0, 44, 115); text-decoration: none;">How to encode into and decode from Base64 format?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#ReadPrivateKey" style="color: rgb(0, 44, 115); text-decoration: none;">How to read a PEM formatted RSA private key?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#ReadPublicKey" style="color: rgb(0, 44, 115); text-decoration: none;">How to read a PEM formatted RSA public key?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#SecureRandom" style="color: rgb(0, 44, 115); text-decoration: none;">How to generate a secure random number?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#RandomAESKey" style="color: rgb(0, 44, 115); text-decoration: none;">How to generate an AES secret key?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#InitRSACipher" style="color: rgb(0, 44, 115); text-decoration: none;">How to initialize a cipher?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#SecretKey" style="color: rgb(0, 44, 115); text-decoration: none;">How to read the shared secret key?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#CreateHMac" style="color: rgb(0, 44, 115); text-decoration: none;">How to create a hash MAC?</a></li><li style="margin: 0px; padding: 0px;"><a class="wikilink" href="https://tuwel.tuwien.ac.at/mod/page/view.php?id=159795#VerifyHMAC" style="color: rgb(0, 44, 115); text-decoration: none;">How to verify a hash MAC?</a></li></ul><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="Base64" id="Base64"></a>How to encode into and decode from Base64 format?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import org.bouncycastle.util.encoders.Base64;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// encode into Base64 format</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] encryptedMessage = ...</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] base64Message = Base64.encode(encryptedMessage);</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// decode from Base64 format</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">encryptedMessage = Base64.decode(base64Message);</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="ReadPrivateKey" id="ReadPrivateKey"></a>How to read a PEM formatted RSA private key?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.KeyPair;</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.PrivateKey;</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import org.bouncycastle.openssl.PEMReader;</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import org.bouncycastle.openssl.PasswordFinder;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String pathToPrivateKey = ...</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">PEMReader in = new PEMReader(new FileReader(pathToPrivateKey), new PasswordFinder() {</code></p><dl style="margin: 1em 1em 1em 2em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><dd style="margin: 0px 0px 0px 1em; padding: 0px;"><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">@Override</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">public char[] getPassword() {</code><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// reads the password from standard input for decrypting the private key</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">System.out.println("Enter pass phrase:");</code></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">return new BufferedReader(new InputStreamReader(System.in)).readLine();</code></div></div><div class="indent" style="margin: 0px; padding: 0px;"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">}</code></div></dd></dl><div class="indent" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">});</code></div><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">KeyPair keyPair = (KeyPair) in.readObject();</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">PrivateKey privateKey = keyPair.getPrivate();</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="ReadPublicKey" id="ReadPublicKey"></a>How to read a PEM formatted RSA public key?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.PublicKey;</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import org.bouncycastle.openssl.PEMReader;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String pathToPublicKey = ...</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">PEMReader in = new PEMReader(new FileReader(pathToPublicKey));</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">PublicKey publicKey = (PublicKey) in.readObject();</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="SecureRandom" id="SecureRandom"></a>How to generate a secure random number?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.SecureRandom;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// generates a 32 byte secure random number</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">SecureRandom secureRandom = new SecureRandom();</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">final byte[] number = new byte[32];</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">secureRandom.nextBytes(number);</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="RandomAESKey" id="RandomAESKey"></a>How to generate an AES secret key?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.KeyGenerator;</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.SecretKey;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">KeyGenerator generator = KeyGenerator.getInstance("AES");</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// KEYSIZE is in bits </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">generator.init(KEYSIZE);</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">SecretKey key = generator.generateKey();</code> </p><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="InitRSACipher" id="InitRSACipher"></a>How to initialize a cipher?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.Cipher;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// make sure to use the right ALGORITHM for what you want to do </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// (see text) </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Cipher crypt = Cipher.getInstance(ALGORITHM);</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// MODE is the encryption/decryption mode </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// KEY is either a private, public or secret key </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// IV is an init vector, needed for AES </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">crypt.init(MODE, KEY [,IV]);</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="SecretKey" id="SecretKey"></a>How to read the shared secret key?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.io.FileInputStream;</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.Key;</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.spec.SecretKeySpec;</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import org.bouncycastle.util.encoders.Hex;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" id="yui_3_9_1_2_1386451846725_420" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] keyBytes = new byte[1024];</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">String pathToSecretKey = ...</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">FileInputStream fis = new FileInputStream(pathToSecretKey);</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">fis.read(keyBytes);</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">fis.close();</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] input = Hex.decode(keyBytes);</code><br><code id="yui_3_9_1_2_1386451846725_419" style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// make sure to use the right ALGORITHM for what you want to do </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// (see text) </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Key key = new SecretKeySpec(input,ALGORITHM);</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="CreateHMac" id="CreateHMac"></a>How to create a hash MAC?</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.Key;</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.Mac;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Key secretKey = ...</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// make sure to use the right ALGORITHM for what you want to do </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// (see text) </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">Mac hMac = Mac.getInstance(ALGORITHM);</code> <br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">hMac.init(secretKey);</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// MESSAGE is the message to sign in bytes </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">hMac.update(MESSAGE);</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] hash = hMac.doFinal();</code></p><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h5 style="margin: 0px; padding: 0px; font-size: 13px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="VerifyHMAC" id="VerifyHMAC"></a>How to verify a hash MAC??</h5><p style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import java.security.MessageDigest;</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">import javax.crypto.Mac;</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">[...]</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// computedHash is the HMAC of the received plaintext </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] computedHash = hMac.doFinal();</code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">// receivedHash is the HMAC that was sent by the communication partner </code><br><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">byte[] receivedHash = ...</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">boolean validHash = MessageDigest.isEqual(computedHash,receivedHash);</code></p><p class="vspace" style="margin: 0px 0px 1em; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></p><hr style="color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><div class="vspace" style="margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><h3 style="margin: 1em 0px; padding: 0px; font-size: 14px; font-weight: bold; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a name="FAQ_RMI" id="FAQ_RMI"></a>Hints &amp; Tricky Parts (RMI)</h3><ul style="margin: 1em 1em 1em 2em; padding: 0px; list-style: disc outside; color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 16px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="margin: 0px; padding: 0px;">To make your object remotely available you have to <strong style="font-style: inherit; font-weight: bold;">export</strong> it. This can either be accomplished by extending <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.server.UnicastRemoteObject</code> or by directly exporting it using the static method <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.server.UnicastRemoteObject.exportObject(Remote obj, int port)</code>. Use <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">0</code> as port, so any available port is selected by the operating system.<div class="vspace" style="margin: 0px; padding: 0px;"></div></li><li style="margin: 0px; padding: 0px;">Before shutting down a server or client, unexport all created remote objects using the static method <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">UnicastRemoteObject.unexportObject(Remote obj, boolean force)</code> – otherwise the application may not stop.<div class="vspace" style="margin: 0px; padding: 0px;"></div></li><li style="margin: 0px; padding: 0px;">Since Java 5 it's not required anymore to create the stubs using the <strong style="font-style: inherit; font-weight: bold;">RMI Compiler</strong> (<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">rmic</code>). Instead java provides an automatic proxy generation facility when exporting the object.<div class="vspace" style="margin: 0px; padding: 0px;"></div></li><li style="margin: 0px; padding: 0px;">Take care of <strong style="font-style: inherit; font-weight: bold;">parameters and return values</strong> in your remote interfaces. In RMI all parameters and return values except for remote objects are passed per value. This means that the object is transmitted to the other side using the java serialization mechanism. So it's required that all parameter and return values are serializable, primitives or remote objects, otherwise you will experience <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.UnmarshalException</code>s.<div class="vspace" style="margin: 0px; padding: 0px;"></div></li><li style="margin: 0px; padding: 0px;">To create a <strong style="font-style: inherit; font-weight: bold;">registry</strong>, use the static method <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.registry.LocateRegistry.createRegistry(int port)</code>. For obtaining a reference in the client you can use the static method <code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">java.rmi.registry.LocateRegistry.getRegistry(String hostName, int port)</code>. Both hostname and port have to be read from the<code style="margin: 0px; padding: 0px; font-style: normal; font-weight: normal; font-family: monospace; line-height: 13px;">registry.properties</code> file.</li></ul><!--EndFragment-->
</body>
</html> 